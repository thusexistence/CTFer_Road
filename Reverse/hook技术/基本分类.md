# Inline Hook 和 PLT Hook 对比

## 1. 支持平台
- **Inline Hook**: 支持多种平台（Windows、Linux、macOS 等），主要用于修改函数代码指令。
- **PLT Hook**: 主要支持 Linux/Unix 系统，针对 ELF 文件的动态链接。

## 2. 修改位置
- **Inline Hook**: 修改目标函数的入口指令，例如函数开头处插入跳转指令。
- **PLT Hook**: 修改 ELF 文件中的 Global Offset Table (GOT)，通过 `.plt` 和 `.got` 实现动态拦截。

## 3. 实现原理
- **Inline Hook**: 
  - 通过直接修改目标函数的内存指令，将其重定位到钩子函数。
  - 常使用 `jmp` 或 `call` 指令。
  - 可以实现对所有函数的直接拦截，无论是静态还是动态链接。
- **PLT Hook**:
  - 修改 `.got` 表中函数地址，重定向到钩子函数。
  - 针对动态链接函数的拦截，依赖 ELF 文件的 `.plt` 和 `.got` 机制。

## 4. 修改范围
- **Inline Hook**:
  - 钩子范围广，可以 Hook 任何可执行代码（如内核函数、用户态函数）。
  - 支持对内存中的直接函数进行修改。
- **PLT Hook**:
  - 钩子范围有限，只能 Hook 使用动态链接的库函数。
  - 不能直接修改静态链接或无 `.plt` 的函数。

## 5. 操作灵活性
- **Inline Hook**:
  - 更灵活，可以控制函数的具体实现逻辑。
  - 可以修改函数入口甚至函数内部的执行流程。
- **PLT Hook**:
  - 钩子生效范围有限，仅对动态链接的外部函数生效。
  - 主要用于拦截库函数调用。

## 6. 可靠性
- **Inline Hook**:
  - 如果目标函数在运行时被修复（例如内存保护、CRC 校验），会导致 Hook 失效。
  - 修改内存权限后存在一定风险（可能导致程序崩溃）。
- **PLT Hook**:
  - 更可靠，依赖于动态链接表的机制，修改 `.got` 表后较难被检测到。

---

## 图解

### **Inline Hook:**
```text
目标函数入口:
+----------------+
| 原始指令       |
| MOV EAX, ...   |  <-- 被替换为 JMP 到钩子函数
+----------------+
        |
        v
钩子函数:
+----------------+
| 自定义逻辑     |
| 跳回目标函数   |
+----------------+
```



# PLT Hook 和 IAT Hook 对比

## 对比表

| 特性               | **PLT Hook**                                   | **IAT Hook**                                   |
|--------------------|-----------------------------------------------|-----------------------------------------------|
| **支持平台**       | Linux/Unix                                    | Windows                                       |
| **目标文件格式**   | ELF                                           | PE                                           |
| **修改的动态表**   | Global Offset Table (GOT)                     | Import Address Table (IAT)                   |
| **函数绑定机制**   | 延迟绑定，运行时解析 `.got`                   | 预绑定，加载时解析并填充 IAT                 |
| **常用工具或函数** | `dlopen`、`dlsym`                             | `LoadLibrary`、`GetProcAddress`              |
| **钩子表类型**     | 修改 `.got` 段中的函数地址                   | 修改 IAT 表中的函数地址                      |
| **实现环境**       | 修改 ELF 文件的 `.got` 表，并调整内存权限    | 修改 PE 文件的 IAT 表，通过 Windows API 实现 |
| **典型场景**       | Linux 下动态链接库函数拦截                    | Windows 下动态链接库函数拦截                 |

---

## 图解

### **PLT Hook:**
```text
函数调用 --> PLT 表 --> GOT 表 (指向目标函数或被 Hook 的地址)
函数调用 --> IAT 表 (直接指向目标函数或被 Hook 的地址)

```